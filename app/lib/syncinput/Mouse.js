import Vector2 from"./Vector2";import Key from"./Key";export default function Mouse(){this._keys=[],this._position=new Vector2(0,0),this._positionUpdated=!1,this._delta=new Vector2(0,0),this._wheel=0,this._wheelUpdated=!1,this._doubleClicked=!1,this.keys=[],this.position=new Vector2(0,0),this.delta=new Vector2(0,0),this.wheel=0,this.doubleClicked=!1,this.canvas=null,this.events=[];for(var e=0;e<3;e++)this._keys.push(new Key),this.keys.push(new Key);var t=this;if(void 0!==window.onmousewheel?this.events.push([window,"mousewheel",function(e){t._wheel=e.deltaY,t._wheelUpdated=!0}]):void 0!==window.addEventListener?this.events.push([window,"DOMMouseScroll",function(e){t._wheel=30*e.detail,t._wheelUpdated=!0}]):this.events.push([window,"wheel",function(e){t._wheel=e.deltaY,t._wheelUpdated=!0}]),"ontouchstart"in window||navigator.msMaxTouchPoints>0){var s=new Vector2(0,0);this.events.push([window,"touchstart",function(e){var i=e.touches[0];s.set(i.clientX,i.clientY),t.updateKey(Mouse.LEFT,Key.DOWN)}]),this.events.push([window,"touchend",function(e){t.updateKey(Mouse.LEFT,Key.UP)}]),this.events.push([window,"touchmove",function(e){var i=e.touches[0];if(null!==t.canvas){var o=t.canvas.getBoundingClientRect();t.updatePosition(i.clientX-o.left,i.clientY-o.top,i.clientX-s.x,i.clientY-s.y)}else t.updatePosition(i.clientX,i.clientY,i.clientX-s.x,i.clientY-s.y);s.set(i.clientX,i.clientY)}])}else this.events.push([window,"mousemove",function(e){if(null!==t.canvas){var s=t.canvas.getBoundingClientRect();t.updatePosition(e.clientX-s.left,e.clientY-s.top,e.movementX,e.movementY)}else t.updatePosition(e.clientX,e.clientY,e.movementX,e.movementY)}]),this.events.push([window,"mousedown",function(e){t.updateKey(e.which-1,Key.DOWN)}]),this.events.push([window,"mouseup",function(e){t.updateKey(e.which-1,Key.UP)}]);for(this.events.push([window,"dblclick",function(e){t._doubleClicked=!0}]),e=0;e<this.events.length;e++){var i=this.events[e];i[0].addEventListener(i[1],i[2])}}Mouse.LEFT=0,Mouse.MIDDLE=1,Mouse.RIGHT=2,Mouse.prototype.setCanvas=function(e){this.canvas=e,e.mouseInside=!1,e.addEventListener("mouseenter",(function(){this.mouseInside=!0})),e.addEventListener("mouseleave",(function(){this.mouseInside=!1}))},Mouse.prototype.insideCanvas=function(){return null!==this.canvas&&this.canvas.mouseInside},Mouse.prototype.setLock=function(e){null!==this.canvas&&(e?this.canvas.requestPointerLock?this.canvas.requestPointerLock():this.canvas.mozRequestPointerLock?this.canvas.mozRequestPointerLock():this.canvas.webkitRequestPointerLock&&this.canvas.webkitRequestPointerLock():document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock())},Mouse.prototype.buttonPressed=function(e){return this.keys[e].pressed},Mouse.prototype.buttonDoubleClicked=function(){return this.doubleClicked},Mouse.prototype.buttonJustPressed=function(e){return this.keys[e].justPressed},Mouse.prototype.buttonJustReleased=function(e){return this.keys[e].justReleased},Mouse.prototype.updatePosition=function(e,t,s,i){this._position.set(e,t),this._delta.x+=s,this._delta.y+=i,this._positionUpdated=!0},Mouse.prototype.updateKey=function(e,t){e>-1&&this._keys[e].update(t)},Mouse.prototype.update=function(){for(var e=0;e<this._keys.length;e++)this._keys[e].justPressed&&this.keys[e].justPressed&&(this._keys[e].justPressed=!1),this._keys[e].justReleased&&this.keys[e].justReleased&&(this._keys[e].justReleased=!1),this.keys[e].set(this._keys[e].justPressed,this._keys[e].pressed,this._keys[e].justReleased);this._wheelUpdated?(this.wheel=this._wheel,this._wheelUpdated=!1):this.wheel=0,this._doubleClicked?(this.doubleClicked=!0,this._doubleClicked=!1):this.doubleClicked=!1,this._positionUpdated?(this.delta.x=this._delta.x,this.delta.y=this._delta.y,this._delta.set(0,0),this.position.x=this._position.x,this.position.y=this._position.y,this._positionUpdated=!1):(this.delta.x=0,this.delta.y=0)},Mouse.prototype.dispose=function(){for(var e=0;e<this.events.length;e++){var t=this.events[e];t[0].removeEventListener(t[1],t[2])}};